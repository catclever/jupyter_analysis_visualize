/**
 * Analysis Requests Data Configuration
 * 分析请求数据配置：所有页面展示的分析任务、步骤、执行过程
 */

export interface StepDetail {
  title: string;        // 通用操作名称
  description: string;  // 个性化的步骤描述内容
}

export interface AnalysisRequest {
  id: string;
  description: string;
  status: "completed" | "pending" | "suggestion";
  timestamp: number; // Unix timestamp
  sourceNodes: string[]; // 起始节点
  outputNode: string; // 最终输出节点
  outputNodeLabel: string; // 输出节点的显示名称
  steps: StepDetail[]; // AI执行步骤详情
}

// Base time for relative timestamp calculations
const baseTime = Date.now();

export const analysisRequests: AnalysisRequest[] = [
  // ===== 数据导入请求（3个）=====
  {
    id: "req-data-1",
    description: "导入用户基本信息数据，从 CRM 系统提取最新的客户档案数据",
    status: "completed",
    timestamp: baseTime - 86400000 * 15 + 3600000 * 1,
    sourceNodes: [],
    outputNode: "data-1",
    outputNodeLabel: "用户基本信息",
    steps: [
      {
        title: "系统连接与认证",
        description: "连接到 CRM 数据库（host: crm.internal.net, port: 5432），验证网络连接、加载数据库驱动、使用 OAuth token 完成身份认证，确认服务可用性",
      },
      {
        title: "数据查询提取",
        description: "执行 SQL SELECT 查询从 users 表提取用户数据，筛选条件：注册时间>=2020-01-01、账户状态=active，共提取 10,247 条记录，耗时 2.3 秒",
      },
      {
        title: "格式转换处理",
        description: "将 CRM 数据格式转换为标准格式：字符编码 UTF-8、日期格式 YYYY-MM-DD、数值精度规范，处理空值和特殊字符，转换后数据量保持 10,247 条",
      },
      {
        title: "质量验证",
        description: "执行数据验证：完整性检查（缺失值 2.1%）、重复值检查（0 条）、数值范围检查（年龄 18-85），验证通过率 99.2%，标记 85 条缺失记录",
      },
      {
        title: "数据导出存储",
        description: "将清理后的 10,162 条数据导出为 Parquet 格式，压缩率 6:1，存储到数据湖：s3://datalake/users/2024-11-05-baseline.parquet，文件大小 7.6MB",
      },
    ],
  },
  {
    id: "req-data-2",
    description: "导入贷款申请数据，从借贷系统同步历史和当期的申请记录",
    status: "completed",
    timestamp: baseTime - 86400000 * 14 + 3600000 * 3,
    sourceNodes: [],
    outputNode: "data-2",
    outputNodeLabel: "贷款申请数据",
    steps: [
      {
        title: "系统连接与认证",
        description: "调用借贷系统 REST API（endpoint: https://lending.api.com/v1/loans），验证 HTTPS 连接、加载 API token、设置超时时间 30 秒，确认服务可用性和权限",
      },
      {
        title: "数据查询提取",
        description: "分页查询 loans 表（每页 1,000 条），查询参数：created_date >= 2020-01-01、status IN (approved, completed)，共 12 页，累计获取 10,543 条申请记录，耗时 8.7 秒",
      },
      {
        title: "格式转换处理",
        description: "将借贷系统数据格式转换为标准格式：字符编码 UTF-8、日期格式 YYYY-MM-DD、数值精度规范，处理 12 个字段的类型转换，转换后数据量保持 10,543 条",
      },
      {
        title: "质量验证",
        description: "执行数据验证：完整性检查（缺失值 1.8%）、重复值检查（0 条）、数值范围检查（金额 500-50万），使用 IQR 方法识别异常值 78 条，验证通过率 98.5%",
      },
      {
        title: "增量合并处理",
        description: "与历史数据合并：新增记录 3,247 条、更新记录 156 条、删除记录 0 条，使用 loan_id 作为合并键，冲突解决策略为最新版本优先，合并后总数 10,543 条",
      },
      {
        title: "数据导出存储",
        description: "将清理后的 10,408 条数据导出为 Parquet 格式，压缩率 5:1，存储到数据湖：s3://datalake/loans/2024-11-05-baseline.parquet，文件大小 12.3MB",
      },
    ],
  },
  {
    id: "req-data-3",
    description: "导入还款历史数据，从金融系统获取客户的长期还款记录",
    status: "completed",
    timestamp: baseTime - 86400000 * 13 + 3600000 * 5,
    sourceNodes: [],
    outputNode: "data-3",
    outputNodeLabel: "还款历史数据",
    steps: [
      {
        title: "系统连接与认证",
        description: "连接到还款系统数据库（host: finance.internal.net, port: 5432），验证网络连接、加载数据库驱动、使用服务账户完成身份认证，确认服务可用性",
      },
      {
        title: "数据查询提取",
        description: "查询还款历史表（repayment_history），时间范围 2019-01-01 至 2024-10-31，共获取 127,654 条还款记录，涵盖 8,932 个借款人，耗时 15.2 秒",
      },
      {
        title: "格式转换处理",
        description: "将还款系统数据格式转换为标准格式：字符编码 UTF-8、日期格式 YYYY-MM-DD、数值精度规范，处理还款状态、金额、逾期天数等字段，转换后数据量保持 127,654 条",
      },
      {
        title: "质量验证",
        description: "执行数据验证：完整性检查（缺失值 0.3%）、重复值检查（0 条）、逾期状态分布检查，准时还款 118,234 条、逾期 1-30 天 6,821 条、逾期 31+ 天 2,599 条，验证通过率 99.7%",
      },
      {
        title: "数据导出存储",
        description: "将清理后的 127,245 条数据导出为 Parquet 格式，压缩率 8:1，存储到数据湖：s3://datalake/repayment/2024-11-05-baseline.parquet，文件大小 18.5MB",
      },
    ],
  },

  // ===== 计算分析请求（7个）=====
  {
    id: "req-1",
    description: "分析申请人的单维度特征分布，包括年龄、收入、职业等基本属性统计",
    status: "completed",
    timestamp: baseTime - 86400000 * 10 + 3600000 * 2 + 600000,
    sourceNodes: ["data-1"],
    outputNode: "compute-1",
    outputNodeLabel: "申请人特征分析",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据分析需求，判断需要用户基本信息（data-1）作为数据源。系统检查当前选中节点：若已选中 data-1 则直接使用，否则自动切换至 data-1。验证 data-1 已完成加载且数据有效（285,000 条用户记录），准备进行特征分析",
      },
      {
        title: "数据清洗与处理",
        description: "数据加载与清洁处理：发现缺失值（年龄 2.1%、职业 1.8%）并补填（年龄用中位数 34.5岁、职业用众数企业员工）。去除异常值和重复记录，最终得到 285,000 条有效的清洁数据集",
      },
      {
        title: "年龄分布分析",
        description: "年龄分布统计：平均年龄 34.5 岁，中位数 34 岁。主要集中在 25-40 岁（占比 73%）。分段统计：25-30 岁占 28%、31-40 岁占 45%、40+ 岁占 27%。分布接近正态，无明显离群值，为后续交叉分析奠定基础",
      },
      {
        title: "收入分布分析",
        description: "收入分布统计：平均月收入 18.2k，中位数 16.5k。主要集中在 10-25k（占比 80%）。分段分布：8-12k 占 22%、12-20k 占 48%、20k+ 占 30%。呈右偏分布，最高 50k、最低 8k",
      },
      {
        title: "职业分布分析",
        description: "职业结构分析：识别 6 大类别——企业员工 45%、个体商户 20%、销售市场 15%、医疗教育 11%、公务员 7%、其他 2%。各职业申请金额差异大（8-35万），为差异化风险评估提供基础",
      },
      {
        title: "特征结果整理",
        description: "生成特征分布统计表（展示于数据面板），包含所有特征的均值、中位数、占比等。发现最主要的客户群体是：31-40 岁、中等收入 12-20k、企业员工。为后续多维度分析提供基础数据",
      },
    ],
  },
  {
    id: "req-2",
    description: "探索年龄和收入两个维度对违约率的影响，发现是否存在高风险人群",
    status: "completed",
    timestamp: baseTime - 86400000 * 9 + 3600000 * 5 + 900000,
    sourceNodes: ["data-1", "data-2"],
    outputNode: "compute-2",
    outputNodeLabel: "年龄-收入交叉分析",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据分析需求，判断需要两个数据源：用户基本信息（data-1）和贷款申请数据（data-2）。系统检查当前选中节点：若仅选中其中一个，则自动补充另一个源；若都未选中则同时加载两个源。验证两个数据源都已完成（data-1: 285,000 条用户记录，data-2: 143,000 条申请记录），准备进行数据融合",
      },
      {
        title: "数据融合与融合验证",
        description: "将 143,000 条贷款申请数据（data-2）与 285,000 条用户信息（data-1）通过用户 ID 进行左连接。成功匹配 143,000 条（100%），融合后获得包含年龄、收入、申请金额、违约情况等 15 个字段的完整数据集",
      },
      {
        title: "年龄-收入分组与分析",
        description: "将融合数据按年龄和收入分组：年龄分 4 档（25-30 岁 28%、31-40 岁 45%、41-50 岁 18%、50+ 岁 9%），收入分 3 档（低收入 8-12k、中等 12-20k、高收入 20k+）。共形成 12 个分析单元，每个单元 45-380 人不等，为下一步风险计算做准备",
      },
      {
        title: "各分群的违约率计算",
        description: "计算每个分群的违约率：发现 25-30 岁+低收入最危险（违约率 24%），31-40 岁+中等收入最安全（违约率 18%），高收入组无论年龄违约率都在 10% 以下。数据完全符合数据面板中的\"年龄-收入散点分析\"表格",
      },
      {
        title: "高风险人群定义",
        description: "识别 3 类高风险人群：①年轻低收入（25-30 岁+8-12k，24% 违约率）②中年中低收入（35-45 岁+8-20k，20% 违约率）③老年低收入（50+ 岁+8-12k，22% 违约率）。这三类人群合计占申请总数 38%，但违约率显著高于均值",
      },
      {
        title: "对比分析发现",
        description: "对比发现：年龄和收入都是独立的风险因子，但作用方向相反。年龄越大越安全（25-30 岁违约率 24% vs 41-50 岁违约率 15%）；收入越高越安全（低收入 20% 违约率 vs 高收入 8% 违约率）。两个因子相乘，形成了 12 个不同的风险等级",
      },
      {
        title: "结果交付",
        description: "生成\"年龄-收入散点分析\"表格（展示于数据面板），清晰展示各分群的申请人数和违约率。为风险定价和额度审批提供直接支撑。初步结论：不能只看年龄或收入，必须综合考虑两个维度",
      },
    ],
  },
  {
    id: "req-3",
    description: "统计不同职业申请者的违约率，识别高风险职业人群",
    status: "completed",
    timestamp: baseTime - 86400000 * 8 + 3600000 * 8,
    sourceNodes: ["data-1", "data-2"],
    outputNode: "compute-3",
    outputNodeLabel: "职业风险分析",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据分析需求，判断需要用户基本信息（data-1）和贷款申请数据（data-2）作为数据源。系统检查当前选中节点：若仅选中其中一个，则自动补充另一个源；若都未选中则同时加载两个源。验证两个数据源都已完成（data-1：285,000 条用户记录，data-2：143,000 条申请记录）且数据有效，准备进行数据融合与职业分类分析",
      },
      {
        title: "数据融合与职业分类标准化",
        description: "融合两个数据源后，从融合数据中提取职业字段并标准化职业分类。原数据有 156 个混乱职业名称（\"软件工程师\"、\"IT 工程师\"、\"程序员\"等混用），统一编码为 6 大类：软件/IT（13%）、销售/市场（15%）、个体/商户（20%）、医疗/教育（11%）、公务员/事业（10%）、其他（31%）",
      },
      {
        title: "职业-申请量统计",
        description: "统计各职业的申请量分布。最多的是个体/商户（28,600 人，20%）和其他（42,600 人，31%），最少的是公务员/事业（14,800 人，10%）。申请额度分化：个体商户平均 35 万（最高），医疗教育平均 20 万（最低），相差 75%",
      },
      {
        title: "职业-违约率统计",
        description: "计算各职业违约率（与\"职业申请数量与违约率统计\"表格对应）：最低是医疗/教育工作者（9%）和公务员/事业单位（10%），最高是个体/商户（28%）和其他工作者（29%）。两者相差 3 倍！说明职业是最强的风险预测因子",
      },
      {
        title: "职业风险分级",
        description: "基于违约率分级：低风险职业（医疗/教育 9%、公务员 10%）、中风险职业（软件/IT 14%、销售/市场 19%）、高风险职业（个体/商户 28%、其他 29%）。发现高风险职业的申请人虽然申请额度更大（35 万），但还款能力更差（违约率 28%）",
      },
      {
        title: "职业-收入关联分析",
        description: "交叉分析发现：同样申请 30 万，医生（违约率 9%）和个体商户（违约率 28%）的风险相差 3 倍。这说明职业决定了收入稳定性和还款能力，是比收入本身更重要的风险指标。需要重点控制高风险职业的申请",
      },
      {
        title: "差异化策略建议",
        description: "提出差异化审批建议：低风险职业（医疗、公务员）可快速审批，申请上限较高；中风险职业常规审批；高风险职业（个体商户）需额外审查，申请上限更低（如限制 20 万以内）。此策略可将整体违约率从 21% 降至 16%",
      },
    ],
  },
  {
    id: "req-4",
    description: "计算不同时间段的逾期率统计，观察逾期风险的整体水平",
    status: "completed",
    timestamp: baseTime - 86400000 * 7 + 3600000 * 3 + 1800000,
    sourceNodes: ["data-3"],
    outputNode: "compute-4",
    outputNodeLabel: "逾期率统计",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据分析需求，判断需要还款历史数据（data-3）作为数据源。系统检查当前选中节点：若已选中 data-3 则直接使用，否则自动切换至 data-3。验证 data-3 已完成加载（127,245 条还款记录，时间范围 2019-01 至 2024-10），数据质量验证通过率 99.7%，准备进行时间序列分解与趋势分析",
      },
      {
        title: "数据时间分解与清洗",
        description: "加载 data-3 还款历史数据，按月份对 2019 年 1 月至 2024 年 10 月共 70 个月的数据进行分解，确保每个月份都有完整的还款记录。数据完整性 99.8%（缺失 2019 年 1-2 月，使用插值补全），准备进行时间序列分析",
      },
      {
        title: "月度指标计算",
        description: "针对每个月度分别计算：当期应还款用户数 N、逾期用户数 L、逾期率 r=L/N、逾期总金额、逾期平均天数、严重逾期（>30 天）占比，生成月度指标时间序列表",
      },
      {
        title: "季节性识别",
        description: "分析逾期率的季节规律：Q1 逾期率平均 2.8%、Q2 平均 2.6%、Q3 平均 3.2%、Q4 平均 3.5%（年底冲量期），识别春节前后、618/双 11 等特殊时间节点的异常突峰",
      },
      {
        title: "趋势分离",
        description: "运用 Hodrick-Prescott 滤波（lambda=129600）分离季节波动和长期趋势，发现长期趋势呈上升态势：2019 年平均逾期率 1.8%→2024 年 3.4%，月均增长 0.15%，表明风险在逐步恶化",
      },
      {
        title: "关键时点标注",
        description: "标注重要经济和政策事件对逾期率的影响：2020 年疫情冲击时期逾期率达 4.2%（历史高点）、2021 年恢复到 2.8%、2023 年又开始上升至 3.4%，分析内在驱动因素",
      },
      {
        title: "预测模型建立",
        description: "基于历史数据拟合 ARIMA(1,1,1) 模型预测未来 6 个月逾期率走势：预测 2024-12 月逾期率 3.6%、2025-01 月 3.8%，置信区间 ±0.5 个百分点",
      },
    ],
  },
  {
    id: "req-5",
    description: "分析申请金额与违约关系，确定金额风险等级划分",
    status: "completed",
    timestamp: baseTime - 86400000 * 6 + 3600000 * 10,
    sourceNodes: ["data-2", "data-3"],
    outputNode: "compute-5",
    outputNodeLabel: "金额与违约关系",
    steps: [
      {
        title: "确认数据源",
        description: "根据分析需求，判断需要贷款申请数据（data-2）和还款历史数据（data-3）作为数据源。系统检查当前选中节点：若仅选中其中一个，则自动补充另一个源；若都未选中则同时加载两个源。验证两个数据源都已完成（data-2：143,000 条申请记录，data-3：127,245 条还款记录），准备进行贷款金额分级与违约风险关联分析",
      },
      {
        title: "数据融合与金额提取",
        description: "融合 data-2 申请信息和 data-3 还款记录，提取贷款金额字段进行关联分析。共 10,543 条有效融合记录，金额范围 500-50 万，中位数 3.5 万，标准差 2.2 万，数据质量验证通过",
      },
      {
        title: "金额分级设计",
        description: "采用 Jenks 自然分级算法（Natural Breaks），最小化组内方差，自动识别最优分割点，将金额分为 8 个等级：[0.5K)、[0.5-1K)、[1-2K)、[2-3K)、[3-5K)、[5-10K)、[10-20K)、[20K+]，各级样本分布均匀（每级 1,200-1,500 条）",
      },
      {
        title: "违约率逐等级计算",
        description: "针对每个金额等级计算关键风险指标：样本数、违约用户数、违约率（分别为 1.2%、2.1%、3.4%、4.8%、5.2%、6.8%、7.2%、8.1%），呈现单调递增趋势，说明金额越大风险越高",
      },
      {
        title: "损失率与逾期分析",
        description: "计算各等级的补充指标：损失率（违约金额占该等级总贷款额）从 0.8%-7.9% 递增、平均逾期天数从 5.2 天增至 23.8 天，严重逾期（>30 天）用户占比从 2% 增至 34%，高金额确实伴随更高的损失风险",
      },
      {
        title: "风险等级划分",
        description: "综合违约率、损失率、逾期天数三个指标，定义三档风险等级：低风险（金额<1K，违约率 1.2%-2.1%）、中风险（1K-10K，违约率 3.4%-6.8%）、高风险（>10K，违约率 7.2%-8.1%），高风险等级占申请总数 18%，但贡献了全部违约损失的 52%",
      },
      {
        title: "等级有效性验证",
        description: "交叉验证等级划分的判别力：用逻辑回归拟合风险等级对违约的预测能力，获得 AUC=0.75（比随机分类的 0.5 显著提升），说明基于金额的风险分级具有较强的预测价值",
      },
      {
        title: "实际应用建议",
        description: "提出差异化审批策略：低风险等级可简化审批流程（2 小时内完成）、中风险等级需要常规审批（1-2 天）、高风险等级需要重点审查和附加担保条件（3-5 天），预期可将整体违约率从 4.5% 降低至 3.2%",
      },
    ],
  },
  {
    id: "req-6",
    description: "对比首贷客户和复贷客户的违约率差异，评估客户忠诚度对风险的影响",
    status: "completed",
    timestamp: baseTime - 86400000 * 5 + 3600000 * 7,
    sourceNodes: ["data-2", "data-3"],
    outputNode: "compute-6",
    outputNodeLabel: "首贷vs复贷对比",
    steps: [
      {
        title: "确认数据源",
        description: "根据分析需求，判断需要贷款申请数据（data-2）和还款历史数据（data-3）作为数据源。系统检查当前选中节点：若仅选中其中一个，则自动补充另一个源；若都未选中则同时加载两个源。验证两个数据源都已完成（data-2：143,000 条申请记录，data-3：127,245 条还款记录），为客户生命周期跟踪与风险演化分析做准备",
      },
      {
        title: "数据融合与客户借款历史追踪",
        description: "融合 data-2 和 data-3，追踪每位客户的完整借款历史，采用 FIFO 原则（以首次借款时间为准）识别：首贷客户 5,432 人（51.5%）只有一笔贷款记录、复贷客户 4,768 人（48.5%）有两笔及以上借款，平均复贷次数 2.3 次",
      },
      {
        title: "客户分类验证",
        description: "验证首复贷分类的准确性：检查数据质量（缺失借款日期 0.1%）、处理重复贷款 ID（发现 12 条）、确认无跨越式借款（从申请日期排序无异常），确保客户类别的准确无误",
      },
      {
        title: "违约率逐类计算",
        description: "分别计算两类客户的详细风险指标：首贷客户违约率 5.2%（违约 283 人）、平均逾期天数 18.5 天、严重逾期占比 12.3%；复贷客户违约率 3.1%（违约 148 人）、平均逾期天数 10.2 天、严重逾期占比 5.8%，两类客户风险存在显著差异",
      },
      {
        title: "客户保留与粘性分析",
        description: "分析复贷客户的保留特征：复贷客户中 78% 与同一机构维持借贷关系、首次借款到复贷间隔平均 14.2 个月、复贷金额相对首贷平均增长 15%，说明复贷客户更稳定且有成长潜力",
      },
      {
        title: "风险差异驱动因素分析",
        description: "分解违约率差异的原因（5.2%-3.1%=2.1%）：客户特征因素贡献 0.8%（复贷客户年龄更大、收入更高、信用更好）、客户行为因素贡献 0.9%（复贷客户还款记录好、按时还款率 98.2% vs 首贷 94.5%）、产品因素贡献 0.4%（复贷客户获得更好的利率和额度）",
      },
      {
        title: "生命周期风险曲线",
        description: "统计复贷客户的风险变化规律：首笔贷款违约率 5.8%、第二笔贷款 2.5%、第三笔及以上 1.2%，说明随着借贷次数增加，客户风险下降，形成明显的学习效应和信用积累过程",
      },
      {
        title: "商业化应用建议",
        description: "基于分析提出运营策略：设计复贷激励方案（降低续贷利率 0.5%-1%）以提高复贷转化率、对首贷客户实施更严格的审批和提额限制、建立忠诚度评分体系（考虑还款行为、账户活跃度等），预期可将整体违约率从 4.2% 降至 3.5%、复贷率从 48% 提升至 55%",
      },
    ],
  },
  {
    id: "req-7",
    description: "进行特征重要性排序，确定哪些特征对风险预测最有影响力",
    status: "completed",
    timestamp: baseTime - 86400000 * 4 + 3600000 * 12,
    sourceNodes: ["compute-1", "compute-2", "compute-3", "compute-4", "compute-5", "compute-6"],
    outputNode: "compute-7",
    outputNodeLabel: "特征重要性排序",
    steps: [
      {
        title: "确认数据源",
        description: "根据分析需求，判断需要 6 个中间计算结果作为数据源：特征分析（compute-1）、年龄-收入分析（compute-2）、职业分析（compute-3）、逾期时间序列（compute-4）、金额风险（compute-5）、首复贷对比（compute-6）。系统检查当前选中节点：需同时拥有全部 6 个计算结果，若缺少则自动加载所有源。验证所有源节点已完成且产出 38 个基础特征，准备进行特征整合与重要性建模",
      },
      {
        title: "特征数据集整合",
        description: "从 6 个中间计算节点汇聚特征数据：compute-1（8 个单变量统计特征）、compute-2（5 个分群特征）、compute-3（7 个行业特征）、compute-4（6 个时间序列特征）、compute-5（8 个金额等级特征）、compute-6（4 个客户生命周期特征），共计 38 个特征，最终形成 10,200 条样本 × 38 个特征的数据矩阵",
      },
      {
        title: "缺失值处理与特征工程",
        description: "处理整合过程中产生的缺失值（0.5%），采用前向填充和均值插值；进行特征工程：衍生交互特征（年龄×金额、收入×行业等）、多项式特征（年龄平方、金额对数），最终特征数增至 52 个",
      },
      {
        title: "数据标准化",
        description: "对所有特征进行零均值单位方差标准化（Z-score normalization），确保数值特征和分类特征在同一尺度，为后续模型训练做准备",
      },
      {
        title: "随机森林模型训练",
        description: "构建随机森林分类器（n_estimators=1000，max_depth=15，min_samples_leaf=10），以违约标记为目标变量，使用 70% 数据训练，30% 数据验证，模型训练耗时 3.2 分钟，最终验证集 AUC=0.78，精准率 76.5%",
      },
      {
        title: "特征重要性提取",
        description: "提取模型的基尼重要性分数（Gini importance），归一化至百分比形式，识别 Top 20 重要特征：申请金额 18.2%、年龄 14.3%、收入 12.8%、逾期历史标记 8.5%、行业类别 7.3%、金额等级 6.2%、客户复贷次数 5.1%、职业 4.8%、地区代码 4.1%、收入等级 3.2%、其他特征 15.5%",
      },
      {
        title: "特征分类解释",
        description: "将 52 个特征按业务含义分类为 6 大类别：人口统计特征（年龄、性别、地区等）贡献度 22.4%、财务特征（收入、资产、借贷金额等）贡献度 28.5%、借贷历史特征（首复贷标记、借贷次数、逾期记录等）贡献度 19.3%、行业职业特征（行业、职业类别）贡献度 12.1%、时间序列特征（还款趋势、逾期频率等）贡献度 11.2%、其他特征贡献度 6.5%",
      },
      {
        title: "模型稳定性验证",
        description: "运行 5 折交叉验证确保重要性排序的稳定性：各折的特征重要性排序前 10 基本一致（肯德尔 Tau 相关系数>0.85），说明排序结果可靠性高，不因数据分割而显著波动",
      },
    ],
  },

  // ===== 图表生成请求（3个）=====
  {
    id: "req-8",
    description: "生成年龄-收入散点图，直观展示不同人群的分布和违约情况",
    status: "completed",
    timestamp: baseTime - 86400000 * 3 + 3600000 * 4,
    sourceNodes: ["compute-2"],
    outputNode: "chart-1",
    outputNodeLabel: "年龄-收入散点图",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据可视化需求，判断需要年龄-收入交叉分析结果（compute-2）作为数据源。系统检查当前选中节点：若已选中 compute-2 则直接使用，否则自动切换至 compute-2。验证 compute-2 已完成（包含 12 个分群数据和各分群违约率统计），准备进行数据提取、违约标记编码与可视化设计",
      },
      {
        title: "数据提取与清洗",
        description: "从 compute-2 中间结果提取年龄和收入两个维度的分群数据，共涉及 10,200 个用户，去除年龄或收入缺失的 250 条记录，得到 9,950 条有效数据点，覆盖 30 个人群分群单元",
      },
      {
        title: "违约标记与编码",
        description: "将违约状态编码为点的颜色：违约用户标记为红色（RGB: 220, 53, 69），正常还款用户标记为蓝色（RGB: 0, 123, 255），使用透明度 0.6 处理重叠点，便于观察点密度",
      },
      {
        title: "散点图生成与美化",
        description: "使用 Plotly 库生成交互式散点图（canvas 大小 1200×800），x 轴为年龄（18-75 岁），y 轴为月收入（1-30K），每个数据点的大小根据贷款金额缩放（范围 100-500）以反映金额高低",
      },
      {
        title: "分群边界标注",
        description: "在图上标注 30 个分群的边界线：年龄边界线（6 条竖直线）、收入分位数边界线（5 条水平线），使用浅灰色虚线以避免掩盖数据点，标注各分群的违约率数值（最高 12.3%、最低 1.8%）",
      },
      {
        title: "高风险区域强调",
        description: "使用颜色背景强调高风险人群区域（违约率>8% 的区域）：覆盖左下方（年轻低收入）的 5 个分群，背景颜色为浅红色（alpha=0.1），并用粗边框标注，帮助决策者快速定位风险人群",
      },
      {
        title: "图例与提示文本",
        description: "添加详细图例：红蓝点标记违约状态、点大小说明贷款金额、虚线说明分群边界；添加鼠标悬停提示文本，显示用户年龄、收入、所属分群、违约状态、贷款金额等详细信息",
      },
      {
        title: "导出与集成",
        description: "将图表导出为 SVG 格式（适合网页嵌入）和 PNG 格式（适合报表打印），图表分辨率 2400×1600 DPI，支持缩放和拖动交互，预期用于业务方的风险评估会议和决策支持",
      },
    ],
  },
  {
    id: "req-9",
    description: "绘制逾期率时间趋势图，展示风险随时间的变化规律",
    status: "completed",
    timestamp: baseTime - 86400000 * 2 + 3600000 * 6,
    sourceNodes: ["compute-4"],
    outputNode: "chart-2",
    outputNodeLabel: "逾期率趋势图",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据可视化需求，判断需要逾期率统计结果（compute-4）作为数据源。系统检查当前选中节点：若已选中 compute-4 则直接使用，否则自动切换至 compute-4。验证 compute-4 已完成（70 个月度逾期指标、季节性分离、ARIMA 预测），数据完整性 99.8%，准备进行时间序列可视化与趋势预测展示",
      },
      {
        title: "时间序列数据整理",
        description: "从 compute-4 提取 70 个月度数据点（2019-01 至 2024-10），每个月度包含：逾期率、逾期金额、逾期人数、严重逾期占比、季节指数等指标，数据完整性 99.8%（只缺 2019 年 1-2 月数据，使用插值补全）",
      },
      {
        title: "多指标曲线绘制",
        description: "使用 matplotlib 绘制多条曲线的组合图表：主要曲线（左 Y 轴）为逾期率（蓝色，宽度 2.5px）、辅助曲线（右 Y 轴）为月度逾期金额（橙色，宽度 2px）、次要指标（灰色虚线）为严重逾期占比，确保三条曲线都清晰可见",
      },
      {
        title: "季节性与趋势分离可视化",
        description: "在图表上同时显示两条拟合线：原始趋势线（Hodrick-Prescott 滤波结果，深蓝虚线）显示长期风险走势（2019 的 1.8% 上升至 2024 的 3.4%）、季节性曲线（深绿虚线）显示周期波动，帮助区分暂时波动和长期恶化",
      },
      {
        title: "事件标注与说明",
        description: "在关键事件时间点添加标注和竖线：2020-03 疫情冲击（逾期率 4.2% 历史高点）、2021-01 市场恢复、2023-08 开始恶化等，添加文字说明可能的驱动因素（宏观经济、政策变化、产品结构等），帮助利益相关者理解波动原因",
      },
      {
        title: "预测区间展示",
        description: "在 2024-10 之后绘制预测区间：使用浅蓝色阴影区间表示 ARIMA 模型的预测范围（置信度 95%），预测 6 个月逾期率范围 3.1%-4.0%，区间宽度随预测期增加而扩大，清晰表达预测的不确定性",
      },
      {
        title: "交互与导出",
        description: "使用 Plotly 实现交互功能：鼠标悬停显示精确数值、点击图例可隐藏/显示对应曲线、支持矩形选区放大、双击还原；导出为 HTML（交互版）和 PNG（静态版），适配不同使用场景和设备",
      },
    ],
  },
  {
    id: "req-10",
    description: "绘制特征重要性柱状图，用于向业务方展示模型驱动因素",
    status: "completed",
    timestamp: baseTime - 86400000 + 3600000 * 9,
    sourceNodes: ["compute-7"],
    outputNode: "chart-3",
    outputNodeLabel: "特征重要性柱状图",
    steps: [
      {
        title: "判断所需数据源",
        description: "根据可视化需求，判断需要特征重要性排序结果（compute-7）作为数据源。系统检查当前选中节点：若已选中 compute-7 则直接使用，否则自动切换至 compute-7。验证 compute-7 已完成（52 个特征的重要性评分、随机森林模型 AUC=0.78），准备进行 Top 特征筛选与可视化呈现",
      },
      {
        title: "特征数据排序与筛选",
        description: "从 compute-7 特征重要性排序结果中提取 Top 15 重要特征（累计贡献度 88.5%），排除贡献度<1% 的特征以简化图表，特征列表：申请金额 18.2%、年龄 14.3%、收入 12.8%、逾期历史 8.5%、行业 7.3%、金额等级 6.2%、复贷次数 5.1%、职业 4.8%、地区 4.1%、收入等级 3.2% 等",
      },
      {
        title: "柱状图绘制与配色",
        description: "使用 matplotlib 绘制水平柱状图（barh），条形宽度 0.6，长度与特征重要性成正比，采用渐进色系：最高重要性（申请金额）使用深蓝（#003366），最低重要性使用浅蓝（#99CCFF），中间特征使用渐进的蓝色阴影，整体视觉平衡且易于对比",
      },
      {
        title: "数值标注与百分比显示",
        description: "在每条柱子的右侧标注具体的重要性百分比数值（字体大小 10pt），精确到小数点后 1 位，对于重要性>5% 的特征额外添加百分比符号，使用对比色（如深灰）确保文字清晰可读，避免与柱子颜色混淆",
      },
      {
        title: "特征分类背景区分",
        description: "将 15 个特征按特征类别分组，用不同颜色的背景条纹表示：人口统计特征（淡蓝背景）、财务特征（淡绿背景）、借贷历史特征（淡黄背景）、其他特征（淡灰背景），帮助业务方快速识别哪类特征对风险影响最大",
      },
      {
        title: "累计贡献度展示",
        description: "在图表右侧添加累计重要性折线（从 0 到 100%），与柱状图共享 Y 轴，使用细红线（宽度 1px）绘制，标注关键累计百分比（25%、50%、75%、100%），帮助理解前几个特征的解释力（Top 3 特征解释 45.3% 的风险）",
      },
      {
        title: "模型可信度标注",
        description: "在图表标题下方或脚注处标注模型训练信息：\"基于随机森林模型（n_estimators=1000，AUC=0.78）的特征重要性评估，验证集精准率 76.5%\"，加强图表的专业性和可信度，便于向非技术利益相关者说明结果的可靠性",
      },
    ],
  },
];
